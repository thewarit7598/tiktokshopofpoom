<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatbot — บ้านแหลมโฮมสเตย์ (Demo)</title>
  <style>
    :root{
      --bg:#0f1721; --card:#0b1220; --accent:#06b6d4; --text:#e6eef6;
    }
    html,body{height:100%; margin:0; font-family:Inter, "Noto Sans Thai", sans-serif; background:linear-gradient(180deg,#06121a 0%, #072434 100%); color:var(--text);}
    .container{max-width:760px; margin:18px auto; padding:12px;}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#053046,#0a6b7a);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;}
    .card{background:rgba(255,255,255,0.03); border-radius:14px; padding:14px; box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .chatWindow{height:60vh; overflow:auto; padding:12px; border-radius:10px; background:linear-gradient(0deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));}
    .msg{margin:8px 0; display:flex;}
    .msg.user{justify-content:flex-end;}
    .bubble{max-width:78%; padding:10px 12px; border-radius:12px; line-height:1.4;}
    .bubble.user{background:linear-gradient(90deg,var(--accent),#0ea5a8); color:#002;}
    .bubble.bot{background:rgba(255,255,255,0.04); color:var(--text);}
    .meta{font-size:12px; opacity:0.7; margin-bottom:6px;}
    .controls{display:flex; gap:8px; margin-top:10px;}
    .input{flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--text);}
    button{background:var(--accent); color:#002; border:none; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer;}
    .hint{font-size:13px; opacity:0.85; margin-top:8px;}
    .kb-item{margin:8px 0; padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02);}
    @media(max-width:520px){
      .chatWindow{height:55vh;}
      .logo{width:48px;height:48px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">บล</div>
      <div>
        <div style="font-weight:800; font-size:18px">บ้านแหลมโฮมสเตย์ — Chat demo</div>
        <div style="font-size:13px; opacity:0.8">ถามเรื่องที่พัก กิจกรรม ผลิตภัณฑ์ และการติดต่อได้</div>
      </div>
    </div>

    <div class="card">
      <div class="chatWindow" id="chatWindow" aria-live="polite"></div>

      <div class="controls" style="margin-top:12px;">
        <input id="userInput" class="input" placeholder="พิมพ์คำถาม เช่น 'ที่พักมีอะไรบ้าง' หรือ 'ติดต่อยังไง'..." />
        <button id="sendBtn">ส่ง</button>
      </div>

      <div class="hint">ตัวอย่างคำถาม: "มีกิจกรรมอะไรบ้าง", "ราคาโคลนขัดผิวเท่าไหร่", "ที่อยู่และเบอร์โทร"</div>
    </div>

    <div style="margin-top:12px;">
      <div style="font-size:14px; font-weight:700; margin-bottom:6px">แหล่งข้อมูล (knowledge base)</div>
      <div class="kb-item" id="kbPreview"></div>
    </div>
  </div>

  <script>
  // ---- ข้อมูลที่ดึงมาจากหน้าเว็บไซต์ baanlaemhomestay.com (สรุปย่อ) ----
  // ถ้าต้องการอัพเดตข้อมูลจริง ให้แก้ข้อมูลในตัวแปรนี้หรือเชื่อม endpoint backend ที่ดึงสดจากเว็บไซต์
  const KB = {
    title: "บ้านแหลมโฮมสเตย์",
    overview: "ที่พักโฮมสเตย์ สัมผัสวิถีชีวิตชุมชน สัมผัสธรรมชาติ ชมหิ่งห้อย ล่องเรือจิบกาแฟแลหวัน และสปาโคลน",
    address: "128/16 หมู่ 7 บ้านหน้าทับ ต.ท่าศาลา อ.ท่าศาลา จ.นครศรีธรรมราช",
    phone: "065-513-7273",
    activities: [
      "ล่องเรือชมพระอาทิตย์ขึ้น / ล่องเรือจิบกาแฟแลหวัน",
      "สปาโคลน / พอกโคลนทะเล",
      "ชมหิ่งห้อยในตอนกลางคืน",
      "ร่วมกิจกรรมชุมชน เช่น การทำเครื่องแกง, ทอหางอวน, ปั้นหม้อดิน",
      "ตกปลา / ปั่นจักรยานในชุมชน / เก็บมัลเบอร์รี่"
    ],
    products: [
      {name:"โคลนขัดผิว", price:"390 บาท", desc:"ขจัดเซลล์ผิวที่ตาย ช่วยให้ผิวกระจ่างใส"},
      {name:"มาร์คหน้าโคลน", price:"300 บาท", desc:"อุดมไปด้วยแร่ธาตุตามธรรมชาติ มากกว่า 40 ชนิด"}
    ],
    notes: "ชุมชนบ้านแหลมเป็นชุมชนเล็กในตำบลท่าศาลา อาชีพหลักคือประมงขนาดเล็ก และมีวิถีชีวิตแบบพอเพียงที่เหมาะแก่การท่องเที่ยวเชิงชุมชน"
  };

  // ใช้เพื่อโชว์สรุปฐานข้อมูลด้านล่าง
  document.getElementById('kbPreview').innerText = KB.overview + " • เบอร์: " + KB.phone + " • ที่อยู่: " + KB.address;

  // ---- ฟังก์ชันตอบคำถามแบบง่าย (keyword matching) ----
  function findAnswer(q){
    const ql = q.toLowerCase();

    // 1) ตอบคำถามทั่วไป / เกี่ยวกับภาพรวม
    if(/(ที่พัก|โฮมสเตย์|ที่พักมีอะไร|ที่พักแบบ)/.test(ql)){
      return KB.overview + "\n\nกิจกรรมเด่น: " + KB.activities.join(" • ");
    }
    // 2) กิจกรรม
    if(/(กิจกรรม|สปา|โคลน|หิ่งห้อย|ล่องเรือ|ชมหิ่งห้อย|พอกโคลน)/.test(ql)){
      return "กิจกรรมที่มี: \n- " + KB.activities.join("\n- ");
    }
    // 3) สินค้า/ราคา
    if(/(ราคา|โคลน|มาร์ค|สินค้า|ผลิตภัณฑ์)/.test(ql)){
      return "สินค้าตัวอย่าง:\n" + KB.products.map(p => `${p.name} — ${p.price} — ${p.desc}`).join("\n");
    }
    // 4) ติดต่อ / ที่อยู่
    if(/(ติดต่อ|เบอร์|โทร|ที่อยู่|อยู่ที่ไหน)/.test(ql)){
      return `ติดต่อ:\nโทร ${KB.phone}\nที่อยู่: ${KB.address}`;
    }
    // 5) กิจกรรมตามเดือน / ปฏิทิน
    if(/(เดือน|ปฏิทิน|ฤดู|เวลา)/.test(ql)){
      return "กิจกรรมตามช่วงปี: มกราคม-พฤศจิกายน: ล่องเรือชมพระอาทิตย์ขึ้น และพอกโคลนทะเล. เดือนธันวาคม: ฤดูมรสุม มีกิจกรรมพายเรือในป่าชายเลนและชมวิถีชาวประมง.";
    }

    // 6) ถามอื่น ๆ: คืนคำตอบอิงจาก KB ด้วยการค้นหาคำสำคัญ
    // ค้นหาในข้อความ KB ทั้งหมดแบบง่าย
    const bigText = (KB.overview + " " + KB.activities.join(" ") + " " + KB.products.map(p=>p.name+" "+p.desc).join(" ") + " " + KB.notes).toLowerCase();
    const words = ql.split(/\W+/).filter(Boolean);
    let matches = [];
    for(const w of words){
      if(w.length < 3) continue;
      if(bigText.includes(w)) matches.push(w);
    }
    if(matches.length){
      // ถ้ามีคำที่ตรงกับ KB ให้คืนข้อความเกี่ยวกับคำเหล่านั้น
      return "ผมพบข้อมูลที่เกี่ยวข้องกับคำว่า: " + [...new Set(matches)].join(", ") + "\n\nลองถามเป็นคำถามเฉพาะเจาะจงมากขึ้น เช่น 'ราคาโคลนขัดผิวเท่าไหร่' หรือ 'มีกิจกรรมชมหิ่งห้อยไหม'";
    }

    // 7) ถ้าไม่พบคำตอบ
    return "ขอโทษครับ ผมยังไม่ทราบคำตอบสำหรับคำถามนี้จากฐานข้อมูลที่มีในตอนนี้ — ลองถามเป็นคำถามเฉพาะเจาะจงมากขึ้น หรือตรวจสอบหน้าเว็บหลักของ บ้านแหลมโฮมสเตย์ เพื่อข้อมูลเพิ่มเติม";
  }

  // ---- UI logic ----
  const chatWindow = document.getElementById('chatWindow');
  const input = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');

  function addMessage(text, who='bot'){
    const wrapper = document.createElement('div');
    wrapper.className = 'msg ' + (who === 'user' ? 'user' : 'bot');
    const bubble = document.createElement('div');
    bubble.className = 'bubble ' + (who === 'user' ? 'user' : 'bot');
    bubble.innerText = text;
    wrapper.appendChild(bubble);
    chatWindow.appendChild(wrapper);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  sendBtn.addEventListener('click', ()=> {
    const t = input.value.trim();
    if(!t) return;
    addMessage(t, 'user');
    input.value = '';
    // จำลองดีเลย์การคิดของบอทเล็กน้อย
    setTimeout(()=> {
      const ans = findAnswer(t);
      addMessage(ans, 'bot');
    }, 300);
  });

  // allow enter to send
  input.addEventListener('keydown', (e)=> {
    if(e.key === 'Enter' && !e.shiftKey){
      e.preventDefault();
      sendBtn.click();
    }
  });

  // welcome message
  addMessage("สวัสดี! ผมเป็นบอทข้อมูลบ้านแหลมโฮมสเตย์ ทดลองถามผมเกี่ยวกับที่พัก กิจกรรม สินค้า หรือการติดต่อได้เลยครับ");
  </script>
</body>
</html>
